<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/languagesStyle.css"/>
    <link rel="stylesheet" href="css/style.css"/>
    <title>Languages</title>
</head>
<body>

<header th:include="menu :: menuFragment"></header>

<div th:replace="authForm.html :: authForm"></div>

<main>
    <!-- Left section -->
    <div id="left-section" th:include="leftNav :: leftNavFragment"></div>
    <!-- Middle section -->
    <div id="middle-section">
        <h1>Countries</h1>
        <div id="app" class="container">
            <card data-image="images/italianCoin.png">
                <h1 slot="header">Italian</h1>
            </card>
            <card data-image="images/japaneseCoin.png">
                <h1 slot="header">Japanese</h1>
            </card>
            <card data-image="images/frenchCoin.png">
                <h1 slot="header">French</h1>
            </card>
            <card data-image="images/portugeseCoin.png">
                <h1 slot="header">Portugese</h1>
            </card>
            <card data-image="images/germanCoin.png">
                <h1 slot="header">German</h1>
            </card>
            <card data-image="images/spanishCoin.png">
                <h1 slot="header">Spanish</h1>
            </card>
            <card data-image="images/arabicCoin.png">
                <h1 slot="header">Arabic</h1>
            </card>
            <card data-image="images/usaCoin.png">
                <h1 slot="header">English</h1>
            </card>
        </div>
    </div>
    <!-- Right section -->
    <div id="right-section" th:if="${session.loggedInUser != null}"
         th:replace="rightFriendsList :: rightFriendsListFragment"></div>
</main>

<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
<script>

    document.addEventListener("DOMContentLoaded", function () {
        const cards = document.querySelectorAll(".card");
        cards.forEach((card, index) => {
            setTimeout(() => {
                card.classList.add("fadeInCountry");
            }, index * 75);
        });
    });

    Vue.config.devtools = true;

    Vue.component('card', {
        template: `
          <div class="card-wrap"
               @mousemove="handleMouseMove"
               @mouseenter="handleMouseEnter"
               @mouseleave="handleMouseLeave"
               ref="card"
               @click="handleCardClick">
            <div class="card"
                 :style="cardStyle">
              <div class="card-bg" :style="[cardBgTransform, cardBgImage]"></div>
              <div class="card-info">
                <slot name="header"></slot>
              </div>
            </div>
          </div>`,
        mounted() {
            this.width = this.$refs.card.offsetWidth;
            this.height = this.$refs.card.offsetHeight;
        },
        props: ['dataImage'],
        data() {
            return {
                width: 0,
                height: 0,
                mouseX: 0,
                mouseY: 0,
                mouseLeaveDelay: null
            };
        },
        computed: {
            mousePX() {
                return this.mouseX / this.width;
            },
            mousePY() {
                return this.mouseY / this.height;
            },
            cardStyle() {
                const rX = this.mousePX * 30;
                const rY = this.mousePY * -30;
                return {
                    transform: `rotateY(${rX}deg) rotateX(${rY}deg)`
                };
            },
            cardBgTransform() {
                const tX = this.mousePX * -10;
                const tY = this.mousePY * -10;
                return {
                    transform: `translateX(${tX}px) translateY(${tY}px)`
                };
            },
            cardBgImage() {
                return {
                    backgroundImage: `url(${this.dataImage})`
                };
            }
        },
        methods: {
            handleMouseMove(e) {
                const mouseX = e.clientX;
                const mouseY = e.clientY;

                const cardRect = this.$refs.card.getBoundingClientRect();
                const cardX = cardRect.left + cardRect.width / 2;
                const cardY = cardRect.top + cardRect.height / 2;

                const relativeMouseX = mouseX - cardX;
                const relativeMouseY = mouseY - cardY;

                this.mouseX = relativeMouseX;
                this.mouseY = relativeMouseY;
            },
            handleMouseEnter() {
                clearTimeout(this.mouseLeaveDelay);
            },
            handleMouseLeave() {
                this.mouseLeaveDelay = setTimeout(() => {
                    this.mouseX = 0;
                    this.mouseY = 0;
                }, 1000);
            },
            handleCardClick() {
                const cardInfoSlot = this.$refs.card.querySelector('.card-info');
                if (cardInfoSlot) {
                    const country = cardInfoSlot.querySelector('h1').innerText;
                    window.location.href = 'countryInfo?header=' + encodeURIComponent(country);
                } else {
                    console.error("Card info slot not found");
                }
            }
        }
    });

    const app = new Vue({
        el: '#app'
    });

    const shakeyButton = document.getElementById('shakeyList');
    const shakeyElement = document.getElementById('shakeyButton');
    shakeyButton.addEventListener('click', function() {
        shakeyElement.classList.add('animate__animated');
        shakeyElement.classList.add('animate__swing');

        setTimeout(() => {
            shakeyElement.classList.remove('animate__animated');
            shakeyElement.classList.remove('animate__swing');
        }, 1000);
    });
</script>
</body>
</html>