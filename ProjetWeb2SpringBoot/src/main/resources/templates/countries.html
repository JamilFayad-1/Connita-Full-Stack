<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/countriesStyle.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="css/style.css"/>
    <title>Countries</title>

    <style>
        .animate__animated.animate__bounce {
            transition: all 1s ease-in-out;
            --animate-duration: 0.8s;
        }
    </style>

</head>
<body>

<header th:include="menu :: menuFragment"></header>

<div th:replace="authForm.html :: authForm"></div>

<main>
    <!-- Left section -->
    <div id="left-section" th:include="leftNav :: leftNavFragment"></div>
    <!-- Middle section -->
    <div id="middle-section">
        <h1>Countries</h1>
        <div id="app" class="container">
            <card data-image="https://images.unsplash.com/photo-1601980740525-fc689655157f?dpr=2&auto=compress,format&fit=crop&w=1199&h=798&q=80&cs=tinysrgb&crop=">
                <h1 slot="header">Italy</h1>
                <p slot="content">Italy: A Cultural Tapestry Unraveled</p>
            </card>
            <card data-image="https://images.unsplash.com/photo-1601823984263-b87b59798b70?dpr=2&auto=compress,format&fit=crop&w=1199&h=799&q=80&cs=tinysrgb&crop=">
                <h1 slot="header">Japan</h1>
                <p slot="content">Japan: Harmony in Diversity, A Cultural Mosaic Revealed</p>
            </card>
            <card data-image="https://images.unsplash.com/photo-1549144511-f099e773c147?dpr=2&auto=compress,format&fit=crop&w=1199&h=799&q=80&cs=tinysrgb&crop=">
                <h1 slot="header">France</h1>
                <p slot="content">France: A Tapestry of Romance, Revolution, and Rendezvous</p>
            </card>
            <card data-image="https://images.unsplash.com/photo-1564659907532-6b5f98c8e70f?dpr=2&auto=compress,format&fit=crop&w=1199&h=811&q=80&cs=tinysrgb&crop=">
                <h1 slot="header">Brazil</h1>
                <p slot="content">Brazil: Where Samba Meets Sun, a Vibrant Tapestry of Life</p>
            </card>
            <card data-image="https://images.unsplash.com/photo-1534313314376-a72289b6181e?dpr=2&auto=compress,format&fit=crop&w=1199&h=798&q=80&cs=tinysrgb&crop=">
                <h1 slot="header">Germany</h1>
                <p slot="content">Germany: Where Tradition Meets Innovation in the Heart of Europe</p>
            </card>
            <card data-image="https://images.unsplash.com/photo-1626368185783-7c928d6f0133?dpr=2&auto=compress,format&fit=crop&w=1199&h=799&q=80&cs=tinysrgb&crop=">
                <h1 slot="header">Argentina</h1>
                <p slot="content">Argentina: Where Tango, Tradition, and Adventure Await!</p>
            </card>
            <card data-image="https://images.unsplash.com/photo-1580746738099-1cb74f972feb?dpr=2&auto=compress,format&fit=crop&w=1199&h=799&q=80&cs=tinysrgb&crop=">
                <h1 slot="header">Morocco</h1>
                <p slot="content">Morocco: A Kaleidoscope of Culture and Adventure</p>
            </card>
            <card data-image="https://images.unsplash.com/photo-1572537165377-627a37043464?dpr=2&auto=compress,format&fit=crop&w=1199&h=811&q=80&cs=tinysrgb&crop=">
                <h1 slot="header">Canada</h1>
                <p slot="content">Canada: Where Nature's Grandeur Meets Cultural Diversity</p>
            </card>
        </div>
    </div>
    <!-- Right section -->
    <div id="right-section" th:if="${session.loggedInUser != null}" th:replace="rightFriendsList :: rightFriendsListFragment"></div>
</main>

<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
<script>

    document.addEventListener("DOMContentLoaded", function() {
        const cards = document.querySelectorAll(".card");
        cards.forEach((card, index) => {
            setTimeout(() => {
                card.classList.add("fadeInCountry");
            }, index * 75);
        });
    });

    Vue.config.devtools = true;

    Vue.component('card', {
        template: `
                <div class="card-wrap"
                    @mousemove="handleMouseMove"
                    @mouseenter="handleMouseEnter"
                    @mouseleave="handleMouseLeave"
                    ref="card"
                    @click="handleCardClick">
                    <div class="card"
                        :style="cardStyle">
                        <div class="card-bg" :style="[cardBgTransform, cardBgImage]"></div>
                        <div class="card-info">
                            <slot name="header"></slot>
                            <slot name="content"></slot>
                        </div>
                    </div>
                </div>`,
        mounted() {
            this.width = this.$refs.card.offsetWidth;
            this.height = this.$refs.card.offsetHeight;
        },
        props: ['dataImage'],
        data() {
            return {
                width: 0,
                height: 0,
                mouseX: 0,
                mouseY: 0,
                mouseLeaveDelay: null
            };
        },
        computed: {
            mousePX() {
                return this.mouseX / this.width;
            },
            mousePY() {
                return this.mouseY / this.height;
            },
            cardStyle() {
                const rX = this.mousePX * 30;
                const rY = this.mousePY * -30;
                return {
                    transform: `rotateY(${rX}deg) rotateX(${rY}deg)`
                };
            },
            cardBgTransform() {
                const tX = this.mousePX * -40;
                const tY = this.mousePY * -40;
                return {
                    transform: `translateX(${tX}px) translateY(${tY}px)`
                };
            },
            cardBgImage() {
                return {
                    backgroundImage: `url(${this.dataImage})`
                };
            }
        },
        methods: {
            handleMouseMove(e) {
                const mouseX = e.clientX;
                const mouseY = e.clientY;

                const cardRect = this.$refs.card.getBoundingClientRect();
                const cardX = cardRect.left + cardRect.width / 2;
                const cardY = cardRect.top + cardRect.height / 2;

                const relativeMouseX = mouseX - cardX;
                const relativeMouseY = mouseY - cardY;

                this.mouseX = relativeMouseX;
                this.mouseY = relativeMouseY;
            },
            handleMouseEnter() {
                clearTimeout(this.mouseLeaveDelay);
            },
            handleMouseLeave() {
                this.mouseLeaveDelay = setTimeout(() => {
                    this.mouseX = 0;
                    this.mouseY = 0;
                }, 1000);
            },
            handleCardClick() {
                const cardInfoSlot = this.$refs.card.querySelector('.card-info');
                if (cardInfoSlot) {
                    const country = cardInfoSlot.querySelector('h1').innerText;
                    window.location.href = 'countryInfo?header=' + encodeURIComponent(country);
                } else {
                    console.error("Card info slot not found");
                }
            }
        }
    });

    const app = new Vue({
        el: '#app'
    });

    const shakeyButton = document.getElementById('shakeyList');
    const shakeyElement = document.getElementById('shakeyButton');
    shakeyButton.addEventListener('click', function() {
        shakeyElement.classList.add('animate__animated');
        shakeyElement.classList.add('animate__swing');

        setTimeout(() => {
            shakeyElement.classList.remove('animate__animated');
            shakeyElement.classList.remove('animate__swing');
        }, 1000);
    });
</script>
</body>
</html>